# Refinery Platform AWS config

# aws-config contains configuration for CloudFormation stacks
# The configuration is stored in two files: config.yaml and tags.yaml
#
# Neither of these files exist to begin with but `config.yaml` is required

<%
require 'json'
require 'ostruct'
tf_json = JSON.parse(`terraform output --json`)
tf = OpenStruct.new(Hash[tf_json.map{|k,v| [k,v['value']]}])
%>

# STACK_NAME is used to name the CloudFormation stacks
# Constraint: alphanumeric characters, underscores, periods, and colons
STACK_NAME: "<%= tf.s3_bucket_name_base %>"

# -------------------------
# Terraform specific values

VPC_ID: "<%= tf.vpc_id %>"
PUBLIC_SUBNET_ID: "<%= tf.public_subnet_id %>"
ELB_SECURITY_GROUP_ID: "<%= tf.elb_security_group_id %>"
APP_SERVER_INSTANCE_ID: "<%= tf.app_server_instance_id %>"

# Prefix for all S3 bucket names (must not be shared among stacks)
# Constraint: DNS-compliant without periods (".")
S3_BUCKET_NAME_BASE: "<%= tf.s3_bucket_name_base %>"

# -------------------------

# AWS ARN for the TLS certifcate to be used for HTTPS connections
# TLS_CERTIFICATE: "arn:aws:acm:--region--:--accountnumber--:certificate/--id--"
