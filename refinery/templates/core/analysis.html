{% extends "base.html" %}

{% block title %}
{% if REFINERY_REPOSITORY_MODE %}
	{{ block.super }} - {{ analysis.name }}
{% else %}
	{{ block.super }} - Analysis {{ analysis.name }}
{% endif %}
{% endblock %}

{% block subheader %}
<div class="page-header">
{% if REFINERY_REPOSITORY_MODE %}
	<h1>{{ analysis.name }}</h1>
{% else %}
	<h1>Analysis&nbsp;<small>{{ analysis.name }}</small></h1>
{% endif %}
</div>
{% endblock %}

{% block content %}
<div class="refinery-panel refinery-panel-content scrollable jquery-full-height">

{% if REFINERY_REPOSITORY_MODE %}
<!-- start repository mode -->
	{% load core_extras %}

	<div class="refinery-header">
		<span class="refinery-header-left">
			<h3>Download</h3>
		</span>
	</div>
	<div class="refinery-subheader">
		<h4>Archive</h4>
	</div>
	{% for result in analysis_results.all %}
		{% for fs in fs_files %}
			{% ifequal result.file_store_uuid fs.uuid %}
				<a href="{{fs.get_datafile}}">{{ fs.uuid|simple_name }}</a>
        ({{ input_filenames|length }} file{{ input_filenames|length|pluralize }}, {{fs.get_file_size|filesizeformat}})
			{% endifequal %}
		{% endfor %}
	{% endfor %}

	<div class="refinery-subheader">
		<h4>Contents</h4>
	</div>
	{{ input_filenames|unordered_list }}

<!-- end repository mode -->
{% else %}
<!-- start default mode -->
	<div class="row">
		<div class="label">Summary</div>
		<p>{{analysis.summary}}</p>

		<div class="label">Workflow</div>
		<p>{{workflow.name}}</p>

		<div class="label">Analysis Inputs</div>
		<ul>
		{% for input in inputs.all %}
			<li><p>Workflow Input Name: {{input.workflow_data_input_name}}</p></li>
		{% endfor %}
		</ul>

		<div class="label">Analysis Outputs</div>

		<div class = "row">
			TODO: Is any of this still in use? The only content here was a link to the obsolete IGV.
        </div>
	</div>
<!-- end default mode -->
{% endif %}

</div>

{% endblock %}
